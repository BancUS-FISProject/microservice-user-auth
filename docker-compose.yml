services:
  mongo:
    image: mongo:7
    container_name: userauth-mongo
    restart: unless-stopped
    command: ["mongod", "--quiet", "--logpath", "/dev/null"]
    ports:
      - "${MONGO_EXPOSED_PORT:-27018}:27017"
    volumes:
      - mongo-data:/data/db
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  api:
    build: .
    container_name: userauth-api
    restart: unless-stopped
    ports:
      - "${PORT:-3000}:${PORT:-3000}"
    environment:
      PORT: ${PORT:-3000}
      MONGO_URI: ${MONGO_URI:-mongodb://mongo:27017/userauth_db}
      MONGO_HOST: ${MONGO_HOST:-mongo}
      MONGO_PORT: ${MONGO_PORT:-27017}
      MONGO_DB: ${MONGO_DB:-userauth_db}
      JWT_SECRET: ${JWT_SECRET:-changeme}
      CAPTCHA_PROVIDER: ${CAPTCHA_PROVIDER:-recaptcha}
      CAPTCHA_SECRET: ${CAPTCHA_SECRET}
      CAPTCHA_TIMEOUT_MS: ${CAPTCHA_TIMEOUT_MS:-3000}
    depends_on:
      - mongo

volumes:
  mongo-data:
